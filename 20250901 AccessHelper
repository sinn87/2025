Imports System.Data.OleDb

Public Class AccessHelper
    Private Shared ReadOnly connStr As String =
        $"Provider=Microsoft.ACE.OLEDB.12.0;Data Source={dbPath};"

    ' üîπ Êü•ËØ¢ÔºåËøîÂõû DataTable
    Public Shared Function GetDataTable(sql As String, Optional params As OleDbParameter() = Nothing) As DataTable
        Dim dt As New DataTable()
        Try
            Using conn As New OleDbConnection(connStr)
                conn.Open()
                Using cmd As New OleDbCommand(sql, conn)
                    If params IsNot Nothing Then cmd.Parameters.AddRange(params)
                    Using da As New OleDbDataAdapter(cmd)
                        da.Fill(dt)
                    End Using
                End Using
            End Using
        Catch ex As OleDbException
            Logger.LogError(ex, "SQLÊâßË°åÂ§±Ë¥•: " & sql)
        End Try
        Return dt
    End Function

    ' üîπ Êü•ËØ¢Âçï‰∏™ÂÄº (Integer, String, Date...)
    Public Shared Function ExecuteScalar(sql As String, Optional params As OleDbParameter() = Nothing) As Object
        Dim result As Object = Nothing
        Try
            Using conn As New OleDbConnection(connStr)
                conn.Open()
                Using cmd As New OleDbCommand(sql, conn)
                    If params IsNot Nothing Then cmd.Parameters.AddRange(params)
                    result = cmd.ExecuteScalar()
                End Using
            End Using
        Catch ex As OleDbException
            Logger.LogError(ex, "SQLÊâßË°åÂ§±Ë¥•: " & sql)
        End Try
        Return result
    End Function

    ' üîπ ÊâßË°å INSERT/UPDATE/DELETE
    Public Shared Function ExecuteNonQuery(sql As String, Optional params As OleDbParameter() = Nothing) As Integer
        Dim rows As Integer = 0
        Try
            Using conn As New OleDbConnection(connStr)
                conn.Open()
                Using cmd As New OleDbCommand(sql, conn)
                    If params IsNot Nothing Then cmd.Parameters.AddRange(params)
                    rows = cmd.ExecuteNonQuery()
                End Using
            End Using
        Catch ex As OleDbException
            Logger.LogError(ex, "SQLÊâßË°åÂ§±Ë¥•: " & sql)
        End Try
        Return rows
    End Function
End Class
