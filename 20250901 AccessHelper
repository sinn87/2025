Imports System.Data.OleDb

Public Class AccessHelper
    Private Shared ReadOnly connStr As String =
        $"Provider=Microsoft.ACE.OLEDB.12.0;Data Source={dbPath};"

    ' ğŸ”¹ æŸ¥è¯¢ï¼Œè¿”å› DataTable
    Public Shared Function GetDataTable(sql As String, Optional params As OleDbParameter() = Nothing) As DataTable
        Dim dt As New DataTable()
        Try
            Using conn As New OleDbConnection(connStr)
                conn.Open()
                Using cmd As New OleDbCommand(sql, conn)
                    If params IsNot Nothing Then cmd.Parameters.AddRange(params)
                    Using da As New OleDbDataAdapter(cmd)
                        da.Fill(dt)
                    End Using
                End Using
            End Using
        Catch ex As OleDbException
            Logger.LogError(ex, "SQLæ‰§è¡Œå¤±è´¥: " & sql)
        End Try
        Return dt
    End Function

    ' ğŸ”¹ æŸ¥è¯¢å•ä¸ªå€¼ (Integer, String, Date...)
    Public Shared Function ExecuteScalar(sql As String, Optional params As OleDbParameter() = Nothing) As Object
        Dim result As Object = Nothing
        Try
            Using conn As New OleDbConnection(connStr)
                conn.Open()
                Using cmd As New OleDbCommand(sql, conn)
                    If params IsNot Nothing Then cmd.Parameters.AddRange(params)
                    result = cmd.ExecuteScalar()
                End Using
            End Using
        Catch ex As OleDbException
            Logger.LogError(ex, "SQLæ‰§è¡Œå¤±è´¥: " & sql)
        End Try
        Return result
    End Function

    ' ğŸ”¹ æ‰§è¡Œ INSERT/UPDATE/DELETE
    Public Shared Function ExecuteNonQuery(sql As String, Optional params As OleDbParameter() = Nothing) As Integer
        Dim rows As Integer = 0
        Try
            Using conn As New OleDbConnection(connStr)
                conn.Open()
                Using cmd As New OleDbCommand(sql, conn)
                    If params IsNot Nothing Then cmd.Parameters.AddRange(params)
                    rows = cmd.ExecuteNonQuery()
                End Using
            End Using
        Catch ex As OleDbException
            Logger.LogError(ex, "SQLæ‰§è¡Œå¤±è´¥: " & sql)
        End Try
        Return rows
    End Function


Public Shared Sub ExecuteReader(sql As String, action As Action(Of OleDbDataReader), Optional params As OleDbParameter() = Nothing)
    Using conn As New OleDbConnection(connStr)
        Using cmd As New OleDbCommand(sql, conn)
            If params IsNot Nothing AndAlso params.Length > 0 Then
                cmd.Parameters.AddRange(params)
            End If
            conn.Open()
            Using reader As OleDbDataReader = cmd.ExecuteReader()
                action(reader)   ' ğŸ”¹ æŠŠå¤„ç†é€»è¾‘äº¤ç»™è°ƒç”¨æ–¹
            End Using
        End Using
    End Using
End Sub



End Class
