ğŸ§© ISavableModule æ¥å£
vb.net
å¤åˆ¶
ç¼–è¾‘
Public Interface ISavableModule
    Sub LoadData(aid As Integer)
    Function HasChanges() As Boolean
    Sub Save(conn As OleDbConnection, tran As OleDbTransaction)
End Interface


ğŸ§© GridModule ç±»ï¼ˆå¯ä»¥é€šç”¨ï¼‰
vb.net
å¤åˆ¶
ç¼–è¾‘
Public Class GridModule
    Implements ISavableModule

    Private dgv As DataGridView
    Private tableName As String

    Public Sub New(targetDgv As DataGridView, tableName As String)
        dgv = targetDgv
        Me.tableName = tableName
    End Sub

    Public Sub LoadData(aid As Integer) Implements ISavableModule.LoadData
        ' ç¤ºä¾‹ï¼šä»æ•°æ®åº“å–æ•°æ®ç»‘å®šåˆ° DGV
        Dim dt As New DataTable
        ' ç”¨ tableName æ„é€  SQL
        ' ç¤ºä¾‹ï¼šSELECT * FROM tableName WHERE AID = ?
        dgv.DataSource = dt
    End Sub

    Public Function HasChanges() As Boolean Implements ISavableModule.HasChanges
        ' ç¤ºä¾‹é€»è¾‘ï¼šæ ¹æ®æ ‡å¿—åˆ—åˆ¤æ–­æ˜¯å¦æœ‰æ”¹åŠ¨
        For Each row As DataGridViewRow In dgv.Rows
            If row.IsNewRow Then Continue For
            If row.Cells("Changed").Value = True Then Return True
        Next
        Return False
    End Function

    Public Sub Save(conn As OleDbConnection, tran As OleDbTransaction) Implements ISavableModule.Save
        ' ç¤ºä¾‹é€»è¾‘ï¼šæ›´æ–°æ¯ä¸€è¡Œ
        ' å»ºè®®ä½¿ç”¨ OleDbCommand + å‚æ•°åŒ–æ›´æ–°
    End Sub
End Class



ğŸ§© MainForm ä¸­çš„ä½¿ç”¨
vb
å¤åˆ¶
ç¼–è¾‘
Private modules As New List(Of ISavableModule)

Private Sub InitModules()
    modules.Clear()

    ' å‡è®¾ Page2 æœ‰ 3 ä¸ª DGVï¼Œå‘½åä¸º dgv21, dgv22, dgv23
    modules.Add(New GridModule(Me.dgv21, "TableA1"))
    modules.Add(New GridModule(Me.dgv22, "TableA2"))
    modules.Add(New GridModule(Me.dgv23, "TableA3"))

    ' Page3
    modules.Add(New GridModule(Me.dgv31, "TableB1"))
    modules.Add(New GridModule(Me.dgv32, "TableB2"))
    modules.Add(New GridModule(Me.dgv33, "TableB3"))

    ' Page4
    modules.Add(New GridModule(Me.dgv41, "TableC1"))
    modules.Add(New GridModule(Me.dgv42, "TableC2"))
    modules.Add(New GridModule(Me.dgv43, "TableC3"))

    ' Page5
    modules.Add(New GridModule(Me.dgv51, "TableD1"))
    modules.Add(New GridModule(Me.dgv52, "TableD2"))
    modules.Add(New GridModule(Me.dgv53, "TableD3"))
End Sub

Private Sub LoadAllData(aid As Integer)
    For Each m In modules
        m.LoadData(aid)
    Next
End Sub

Private Sub SaveAllData()
    Using conn As New OleDbConnection(connStr)
        conn.Open()
        Dim tran = conn.BeginTransaction()

        Try
            For Each m In modules
                If m.HasChanges() Then
                    m.Save(conn, tran)
                End If
            Next

            tran.Commit()
            MsgBox("ä¿å­˜æˆåŠŸ")
        Catch ex As Exception
            tran.Rollback()
            MsgBox("ä¿å­˜å¤±è´¥ï¼š" & ex.Message)
        End Try
    End Using
End Sub
