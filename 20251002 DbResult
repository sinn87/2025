' ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œã®çµæžœã‚’ã‚«ãƒ—ã‚»ãƒ«åŒ–ã™ã‚‹ã‚¯ãƒ©ã‚¹
Public Class DbResult(Of T)
    Public Property Success As Boolean     ' æˆåŠŸã—ãŸã‹ã©ã†ã‹
    Public Property Data As T              ' æˆ»ã‚Šå€¤ãƒ‡ãƒ¼ã‚¿ï¼ˆDataTable / List / ä»»æ„ã®åž‹ï¼‰
    Public Property ErrorMessage As String ' ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆä»»æ„ï¼‰
    Public Property Exception As Exception ' ä¾‹å¤–ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆä»»æ„ï¼‰

    Public Sub New(success As Boolean, Optional data As T = Nothing, Optional err As String = Nothing, Optional ex As Exception = Nothing)
        Me.Success = success
        Me.Data = data
        Me.ErrorMessage = err
        Me.Exception = ex
    End Sub
End Class



Public Shared Function ExecuteReader(sql As String,
                                     action As Action(Of OleDbDataReader),
                                     Optional params As OleDbParameter() = Nothing) As DbResult(Of Boolean)
    Try
        Using conn As New OleDbConnection(connStr)
            Using cmd As New OleDbCommand(sql, conn)
                If params IsNot Nothing AndAlso params.Length > 0 Then
                    cmd.Parameters.AddRange(params)
                End If
                conn.Open()
                Using reader As OleDbDataReader = cmd.ExecuteReader()
                    action(reader)   ' ðŸ”¹ æŠŠå¤„ç†é€»è¾‘äº¤ç»™è°ƒç”¨æ–¹
                End Using
            End Using
        End Using
        Return New DbResult(Of Boolean)(True, True)
    Catch ex As Exception
        Return New DbResult(Of Boolean)(False, False, ex.Message, ex)
    End Try
End Function

ExecuteScalar â†’ å•å€¼ç»“æžœ

Public Shared Function ExecuteScalar(Of T)(sql As String,
                                           Optional params As OleDbParameter() = Nothing) As DbResult(Of T)
    Try
        Using conn As New OleDbConnection(connStr)
            Using cmd As New OleDbCommand(sql, conn)
                If params IsNot Nothing AndAlso params.Length > 0 Then
                    cmd.Parameters.AddRange(params)
                End If
                conn.Open()
                Dim value = CType(cmd.ExecuteScalar(), T)
                Return New DbResult(Of T)(True, value)
            End Using
        End Using
    Catch ex As Exception
        Return New DbResult(Of T)(False, Nothing, ex.Message, ex)
    End Try
End Function

ExecuteNonQuery â†’ è¿”å›žå—å½±å“è¡Œæ•°
Public Shared Function ExecuteNonQuery(sql As String,
                                       Optional params As OleDbParameter() = Nothing) As DbResult(Of Integer)
    Try
        Using conn As New OleDbConnection(connStr)
            Using cmd As New OleDbCommand(sql, conn)
                If params IsNot Nothing AndAlso params.Length > 0 Then
                    cmd.Parameters.AddRange(params)
                End If
                conn.Open()
                Dim count = cmd.ExecuteNonQuery()
                Return New DbResult(Of Integer)(True, count)
            End Using
        End Using
    Catch ex As Exception
        Return New DbResult(Of Integer)(False, -1, ex.Message, ex)
    End Try
End Function
